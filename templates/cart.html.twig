{% extends 'base.html.twig' %}

{% block title %}Nákupní košík{% endblock %}

{% block content %}
    <section class="content-section">

        {{ include('_order_progress_bar.html.twig') }}

        {% if not cart.minimalPriceMet %}
            <div class="alert alert-warning fs-sm">
                Minimální hodnota objednávky pro rozvoz je {{ cart.minimalPrice|price|raw }}&nbsp;Kč. Abyste mohli pokračovat k dokončení objednávky, prosím přidejte si ještě něco do košíku nebo zvolte osobní odběr.
            </div>
        {% endif %}

        {% for item in cart.items %}
            <div class="d-flex cart-items-row p-3 my-2 shadow">
                <div class="cart-item-image">
                    {% if asset_exists('img/produkty/' ~ item.product.id ~ '.png') %}
                        <img class="rounded-3" src="{{ asset('img/produkty/' ~ item.product.id ~ '.png') }}" alt="Product">
                    {% else %}
                        <img class="rounded-3" src="{{ asset('img/placeholder.jpg') }}" alt="Product">
                    {% endif %}
                </div>

                <div class="cart-item-info ps-3">
                    <h3 class="h6 mb-1">{{ item.product.title }}</h3>
                    <div class="d-inline-block fs-sm">
                        {% if item.product.turkeyType %}
                            <span class="text-muted fs-xs">
                                Hmotnost: {{ item.product.weightFrom }} až {{ item.product.weightTo }} kg<br>
                                Orientační cena: {{ item.product.price|price|raw }} Kč/ks
                            </span><br>
                            Celkem: {{ item.price|price|raw }} Kč
                        {% else %}
                            <span class="text-muted fs-xs">Cena: {{ item.product.price|price|raw }} Kč/kg</span><br>
                            Celkem: {{ item.price|price|raw }} Kč
                            {% if item.slice %}
                                <br>+ Nakrájet
                            {% endif %}
                            {% if item.pack %}
                                <br>+ Vakuově zabalit (+{{ item.product.packPrice }} kč)
                            {% endif %}
                        {% endif %}
                    </div>


                    <div class="form-inline pt-2">
                        <div class="text-end mb-2">
                            <a data-turbo-prefetch="false" href="{{ path('remove_from_cart', {cartItem: loop.index0}) }}">
                                <span class="btn btn-sm btn-icon btn-outline-danger py-1 px-2 fs-xs mt-1">
                                    <i class="ci-trash me-1"></i> Odebrat
                                </span>
                            </a>
                        </div>

                        {{ form_start(change_quantity_forms[loop.index0]) }}
                            <input name="{{ field_name(change_quantity_forms[loop.index0].quantity) }}" style="width: 60px;" class="text-center form-control d-inline-block form-control-sm me-1" type="text" value="{{ item.quantity }}"> {% if item.product.turkeyType %}ks{% else %}Kg{% endif %}
                            <button class="btn btn-primary btn-sm ms-2 " type="submit">Přepočítat</button>
                        {{ form_end(change_quantity_forms[loop.index0]) }}
                    </div>
                </div>
            </div>
        {% endfor %}

        {% if cart.itemsCount == 0 %}
            <div class="alert alert-primary d-flex" role="alert">
                <div class="alert-icon">
                    <i class="ci-security-announcement"></i>
                </div>
                <div>Váš košík je prázdný. Vyberte si něco <a class="alert-link" href="{{ path('products') }}">z naší nabídky</a>.</div>
            </div>
        {% else %}
            <div class="py-4">

                <h2 class="h6 mb-2">
                    {% if cart.deliveryPlace and cart.deliveryAddress %}
                        <span class="fs-sm d-block mb-1">
                            Doprava: {{ cart.deliveryPrice }} Kč<br>
                            Balné: {{ cart.packingPrice }} Kč
                        </span>
                    {% endif %}
                    Orientační cena celkem: {{ cart.totalPrice.amount|price|raw }} Kč
                </h2>
            </div>
        {% endif %}

        <div class="d-sm-flex justify-content-between text-center mt-3">
            <a class="btn btn-outline-secondary m-1" href="{{ path('products') }}"><i class="ci-arrow-left me1"></i> Zpět na výběr zboží</a>
            <a class="btn btn-primary m-1" href="{{ path('order_delivery') }}"><i class="ci-delivery me-1"></i> Vybrat způsob doručení</a>
        </div>

    </section>
{% endblock %}
